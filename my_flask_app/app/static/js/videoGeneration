
function generateVideo() {
    previewVideo('path/to/your/video.mp4'); // Change this to the URL of your video
    // Recopilar información de introducción
    const introText = document.getElementById('introText').value.trim();

    // Determinar el tipo de video
    const videoType = document.getElementById('videoType').value;

    // Recopilar información de hechos (facts) o narración
    let content = [];

    if (videoType === 'facts') {
        const facts = document.querySelectorAll('textarea[name="fact[]"]');
        content = Array.from(facts).map(fact => fact.value.trim()).filter(fact => fact !== '');
    } else if (videoType === 'narration') {
        const narrationText = document.getElementById('narrationText').value.trim();
        if (narrationText) {
            content.push(narrationText);
        }
    }

    // Recopilar información de los enlaces de video y música
    const videoLink = document.getElementById('videoLink').value.trim();
    const musicLink = document.getElementById('musicLink').value.trim();

    // Verificar si se subieron archivos
    const videoFileInput = document.getElementById('videoHiddenFileInput');
    const musicFileInput = document.getElementById('musicHiddenFileInput');
    let videoFile = null;
    let musicFile = null;

    if (videoFileInput && videoFileInput.files.length > 0) {
        videoFile = videoFileInput.files[0];
    }

    if (musicFileInput && musicFileInput.files.length > 0) {
        musicFile = musicFileInput.files[0];
    }

    var formData = new FormData();
    formData.append('introText', introText);
    formData.append('videoType', videoType);
    formData.append('content', JSON.stringify(content));
    formData.append('videoLink', videoLink);
    formData.append('musicLink', musicLink);
    formData.append('lang', currentLanguage);
    formData.append('musicFile', musicFile);  
    formData.append('videoFile', videoFile);

    fetch('/generate-video/', {
        method: 'POST',     
        body: formData
    })
    .then(response => response.blob())
    .then(data => {
        previewVideo(data);
        // hideLoadingScreen();
        // const aElement = document.createElement("a");
        // aElement.setAttribute("download", "output.mp4");
        // const href = window.URL.createObjectURL(data);
        // aElement.href = href;
        // aElement.setAttribute("target", "_blank");
        // aElement.click();
        // URL.revokeObjectURL(href);
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}


function showLoadingScreen() {
    document.getElementById('loadingScreen').style.display = 'flex';
}

// Function to hide the loading screen
function hideLoadingScreen() {
    document.getElementById('loadingScreen').style.display = 'none';
}

function previewVideo(videoUrl) {
    // Get the modal
    var modal = document.getElementById("videoModal");

    // Get the video element and the download button
    var video = document.getElementById("previewVideo");
    var videoSource = document.getElementById("videoSource");
    var downloadButton = document.getElementById("downloadButton");

    // Function to fetch video
    function fetchAndDisplayVideo() {
        fetch(videoUrl) // URL of the video
            .then(response => response.blob())
            .then(blob => {
                var url = URL.createObjectURL(blob);
                videoSource.src = url;
                video.load();
                downloadButton.href = url;
                modal.style.display = "block"; // Open the modal
            })
            .catch(error => {
                console.error('Error fetching video:', error);
            });
    }

    // When the user clicks on <span> (x), close the modal
    document.getElementsByClassName("close")[0].onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // Fetch and display the video
    fetchAndDisplayVideo();
}

// Get the button that opens the modal
document.getElementById("previewButton").onclick = function() {
    previewVideo('path/to/your/video.mp4'); // Change this to the URL of your video
}
